(function(a,b,c){function d(c){if(!(this instanceof d))return new d(c);if(typeof c=="string")this.element=b.getElementById(c);else if(c instanceof HTMLElement)this.element=c;else if(c instanceof NodeList)this.element=c;else if(c===a)this.element=a;else{if(c instanceof d)return c;this.element=b}}d.prototype={find:function(a){return DOM(this.element.querySelector(a))},findAll:function(a){return DOM(this.element.querySelectorAll(a))},off:function(b){this.element&&(this.element.eventHandlers=this.element.eventHandlers||{});switch(b){case"touch":return b="ontouchstart"in a?"touchstart":"mousedown",this.off(b),this;case"move":return b="ontouchmove"in a?"touchmove":"mousemove",this.off(b),this;case"touched":return b="ontouchend"in a?"touchend":"mouseup",this.off(b),b="ontouchcancel"in a?"touchcancel":"mousecancel",this.off(b),b="ontouchleave"in a?"touchleave":"mouseleave",this.off(b),this;default:return this.element.eventHandlers[b]&&this.element.removeEventListener(b,this.element.eventHandlers[b],!1),this}},on:function(b,c,d,e){var f=d||{},g=function(a){a.preventDefault(),a.stopPropagation(),a.touches&&(a=a.touches[0]),f.target=a.target||a.srcElement;if(f.watch){var b=3;while(b--){if(f.target.nodeName==f.watch.toUpperCase())break;f.target=f.target.parentNode}}f.target.hasAttribute&&(f.target.hasAttribute("data")&&(f.transfer=JSON.parse(f.target.getAttribute("data"))),f.target.hasAttribute("href")&&(f.href=f.target.getAttribute("href"))),f.target.value&&(f.value=f.target.value),a.data&&a.origin&&(f.transfer=a.data,f.origin=a.origin,f.timeStamp=a.timeStamp,f.type=a.type),a.keyCode&&(f.keyCode=a.keyCode);if(a.clientX>0||a.offsetX>0||a.layerX>0)f.koord={clientX:a.clientX,clientY:a.clientY,offsetX:a.offsetX||a.layerX,offsetY:a.offsetY||a.layerY};c(f)};this.element&&(this.element.eventHandlers=this.element.eventHandlers||{});switch(b){case"touch":return b="ontouchstart"in a?"touchstart":"mousedown",this.on(b,c,f),this;case"move":return b="ontouchmove"in a?"touchmove":"mousemove",this.on(b,c,f),this;case"touched":return b="ontouchend"in a?"touchend":"mouseup",this.on(b,c,f),b="ontouchcancel"in a?"touchcancel":"mousecancel",this.on(b,c,f),b="ontouchleave"in a?"touchleave":"mouseleave",this.on(b,c,f),this;case"touchstart":f.type="start";break;case"touchmove":f.type="move";break;case"touchend":f.type="end";break;case"touchleave":f.type="leave";break;case"touchcancel":f.type="leave";break;case"mousedown":f.type="start";break;case"mousemove":f.type="move";break;case"mouseup":f.type="end";break;case"mouseout":f.type="leave";break;case"mouseleave":f.type="leave";break;case"mousecancel":f.type="leave";break;case"modal":b="blur";break;case"msg":b="message";break;case"tab":b="visibilitychange";break;case"return":b="keydown";break;case"change":break;case"keyup":break;case"focus":break;case"input":break;case"stage":b="transitionend";case"transitionend":break;case"ready":b=a.device?"deviceready":"DOMContentLoaded";break;case"load":break;case"resume":break;case"submit":break;case"resize":break;default:console.log("No definition for "+b)}return this.element.eventHandlers[b]=g,this.element.addEventListener(b,g,!1),this},parent:function(){return DOM(this.element.parentNode)},inherit:function(a){return this.prototype=new a,this},prefix:function(a){var b=["webkit","moz","ms","o",""],c=[];for(var d=0;d<b.length;d++)c.push(b[d]+a.charAt(0).toUpperCase()+a.slice(1));return c},hash:function(){return a.location.hash.replace("#","")},removeHash:function(){history.pushState("",b.title,a.location.pathname)},device:function(){var a=navigator.userAgent;return a.match(/GoogleTV|SmartTV|Internet.TV|NetCast|NETTV|AppleTV|boxee|Kylo|Roku|DLNADOC|CE\-HTML/i)?"tv":a.match(/Xbox|PLAYSTATION.3|Wii/i)?"tv":a.match(/iPad/i)||a.match(/tablet/i)&&!a.match(/RX-34/i)||a.match(/FOLIO/i)?"tablet":a.match(/Linux/i)&&a.match(/Android/i)&&!a.match(/Fennec|mobi|HTC.Magic|HTCX06HT|Nexus.One|SC-02B|fone.945/i)?"tablet":a.match(/Kindle/i)||a.match(/Mac.OS/i)&&a.match(/Silk/i)?"tablet":a.match(/GT-P10|SC-01C|SHW-M180S|SGH-T849|SCH-I800|SHW-M180L|SPH-P100|SGH-I987|zt180|HTC(.Flyer|\_Flyer)|Sprint.ATP51|ViewPad7|pandigital(sprnova|nova)|Ideos.S7|Dell.Streak.7|Advent.Vega|A101IT|A70BHT|MID7015|Next2|nook/i)||a.match(/MB511/i)&&a.match(/RUTEM/i)?"tablet":a.match(/BOLT|Fennec|Iris|Maemo|Minimo|Mobi|mowser|NetFront|Novarra|Prism|RX-34|Skyfire|Tear|XV6875|XV6975|Google.Wireless.Transcoder/i)?"mobile":a.match(/Opera/i)&&a.match(/Windows.NT.5/i)&&a.match(/HTC|Xda|Mini|Vario|SAMSUNG\-GT\-i8000|SAMSUNG\-SGH\-i9/i)?"mobile":a.match(/Windows.(NT|XP|ME|9)/)&&!a.match(/Phone/i)||a.match(/Win(9|.9|NT)/i)?"desktop":a.match(/Macintosh|PowerPC/i)&&!a.match(/Silk/i)?"desktop":a.match(/Linux/i)&&a.match(/X11/i)?"desktop":a.match(/Solaris|SunOS|BSD/i)?"desktop":a.match(/Bot|Crawler|Spider|Yahoo|ia_archiver|Covario-IDS|findlinks|DataparkSearch|larbin|Mediapartners-Google|NG-Search|Snappy|Teoma|Jeeves|TinEye/i)&&!a.match(/Mobile/i)?"desktop":"mobile"},style:function(a,b){if(b!=c)return this.element.style.setProperty(a,b),this;this.element.style.getAttribute(a)},setStylePrefix:function(a,b){var c=["-webkit","-moz","-ms","-o"];for(var d=0;d<c.length;d++)this.style(c[d]+"-"+a,b)},show:function(){if(this.element instanceof NodeList){var a=this.element.length;while(a--)this.element[a].style.display="block",this.element[a].style.visibility="visible"}else this.element.style.display="block",this.element.style.visibility="visible";return this},invisible:function(){this.element.style.visibility="hidden"},hide:function(a){if(this.element instanceof NodeList){var b=this.element.length;while(b--)this.element[b].style.display="none"}else this.element.style.display="none";return this},swipe:function(a){return this.replaceClass(/(right|left|top|bottom|middle)/,a),this},html:function(a){return a!=null?(this.element.innerHTML=a,this):this.element.innerHTML},text:function(a,b){return a?(b?this.element.textContent=a.length<=b?a:a.substr(0,b-2)+"..":this.element.textContent=a,this):this.element.textContent},add:function(a,b,c){var d=typeof a=="string"?this.create(a):a;for(var e in b)d.setAttribute(e,b[e]);return a=="textarea"&&c&&(d.value=c),a!="textarea"&&c&&(d.innerHTML=c),this.element.appendChild(d),DOM(d)},addPrevious:function(a,b,c){var d=this.create(a,b,c);return this.parent().element.insertBefore(d,this.element),DOM(d)},addNext:function(a,b,c){return this.parent().add(a,b,c)},remove:function(){if(this.element instanceof NodeList){var a=this.element.length;while(a--)this.element[a].parentNode.removeChild(this.element[a])}else this.element.parentNode.removeChild(this.element);return this},removeChilds:function(){while(this.element.hasChildNodes())this.element.removeChild(this.element.lastChild);return this},hasChilds:function(){return this.element.hasChildNodes()},addClass:function(a){var b=a.split(" ");for(var c=0;c<b.length;c++)this.element.classList.add(b[c]);return this},removeClass:function(a){if(this.element instanceof NodeList){var b=this.element.length;while(b--)this.element[b].classList.remove(a)}else this.element.classList.remove(a);return this},replaceClass:function(a,b){return this.element.className=this.element.className.replace(a,b),this},hasClass:function(a){return this.element.classList.contains(a)},create:function(a){return b.createElement(a)},fragments:function(a){var c=b.createDocumentFragment();for(var d=0;d<a.length;d++)c.appendChild(a[d]);return this.add(c),this},attrib:function(a,b){return a&&b?(this.element.setAttribute(a,b),this):this.element.getAttribute(a)},get:function(a){return this.element[a]},set:function(a,b){return this.element[a]=b,this},toggle:function(a,b){this.attrib(a,this.attrib(a)==b[0]?b[1]:b[0])},removeAttrib:function(a){return this.element.removeAttribute(a),this},width:function(a){return a&&this.attrib("width",a),Math.floor(this.element.offsetWidth)},height:function(a){return a&&this.attrib("height",a),Math.floor(this.element.offsetHeight)},child:function(a){return DOM(this.element.childNodes[a])},childs:function(){return this.element.childNodes},scrollToIndex:function(a){var b=this.height(),c=this.child(a).height(),d=Math.floor(a*c)-b/2+c/2+a%2;this.scrollTo("scrollTop",d,500)},scrollTo:function(a,b,c){function i(a,b,c,d){return a/=d/2,a<1?c/2*a*a+b:(a--,-c/2*(a*(a-2)-1)+b)}var d=this.element[a],e=b-d,f=0,g=20,h=this.element,j=null;j=function(){f+=g;var b=i(f,d,e,c);h[a]=b,f<c&&setTimeout(j,g)},j()},tracking:function(c){var d=[];d.push(["_setAccount","UA-9955206-2"]),d.push(["_setDomainName",c]),d.push(["_trackPageview"]),a._gaq=d,function(){var a=b.createElement("script");a.type="text/javascript",a.async=!0,a.src=("https:"==b.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js";var c=b.getElementsByTagName("script")[0];c.parentNode.insertBefore(a,c)}()},track:function(a){_gaq.push(["_trackPageview",a])},log:function(a){return console.log(this.element).bind(a),this},info:function(b){this.addClass("blur"),a.confirm(b),this.removeClass("blur")},busy:function(){var a=this.add("div");for(var b=0;b<12;b++){var c=a.add("div").addClass("spinner");c.setStylePrefix("transform","rotate("+b*30+"deg) translate(0, -120%)"),c.setStylePrefix("animation-delay",b/12+"s")}return a},notBusy:function(){return this.find(".spinner").parent().remove()},error:function(a){this.removeChilds();var b,c,d;switch(a){case"oldbrowser":b="Aktuellen Browser verwenden",c="Ihr Browser ist zu alt. Die verwendeten Darstellungen k&ouml;nnen nur von den aktuellen Versionen der Browser <a href='http://chrome.google.com'>Chrome</a>, <a href='http://mozilla.org/firefox/'>Firefox</a>, <a href='http://windows.microsoft.com/de-ch/internet-explorer/download-ie'>Internet Explorer</a>, <a href='http://www.opera.com/de/''>Opera</a> oder <a href='www.apple.com/de/safari'>Safari</a> korrekt dargestellt werden.";break;default:b="Uups... Anfrage war fehlerhaft",c="Der Service ist aktuell nicht verfügbar. Bitte versuchen Sie es später noch einmal."}d="Email: support@epha.ch";var e=this.add("div").addClass("error");e.add("h2").text(b),e.add("p").html(c),e.add("p").text(d)}},a.DOModule=d.prototype,a.DOM=d})(this,document,undefined);
var Node={init:function(a){return this.service=a.split(".")[0],document.domain==a||window.device?(this.domain=document.domain="epha.ch",this.server="https://node.epha.ch",this.live=!0):(document.domain=document.domain,this.server="http://"+document.domain+":8080",this.live=!1),this.live},navigation:function(){window.device?(window.device.phonegap=="3.0.0"&&window.device.platform=="iPhone"&&parseFloat(window.device.version)===7?DOM(document).find("body").style("margin-top","20px"):DOM(document.body).style("margin-top","0"),this.getActor()):this.createNavigation()},createNavigation:function(){var a=DOM(document.body).find("article"),b=a.addPrevious("header").addClass("konto").add("iframe",{src:this.server,style:"position:fixed; top:0px; width:100%; height:42px; border:none;"});b.on("load",function(){Node.sso=b.element.contentWindow,DOM(window).on("msg",function(a){a.transfer.request=="REDIRECT"&&location.replace(a.transfer.target)}),Node.getActor()})},getActor:function(a){if(window.device){var b=JSON.parse(localStorage.getItem("device_actor"));a(b)}else Node.sso.postMessage({request:"ACTOR_GET"},"*"),DOM(window).on("msg",function(b){a(b)})},getActs:function(a){if(window.device){var b=localStorage.getItem("device_acts");a(b)}else this.listActsForAntagonistId(antagonistId,since,function(b){b.status==200?a(b.message):a()})},setActor:function(a,b){this.query("GET","/authenticate?"+urlVariables,b)},readActorsByCredential:function(a,b){this.query("GET","/authenticate?"+this.toQuery(a),b)},readActorByRequestToken:function(a,b,c){this.query("GET","/authorize?requestToken="+a,b,c)},findActorsForRoleId:function(){},findActorsForScopeId:function(a,b,c,d){var e="/actors/scopeId/"+a;this.query("GET",e,c,d,null,b)},findActorForId:function(){},updateActorById:function(a,b,c,d){var e="/actors/"+a;this.query("PUT",e,c,d,b)},listActsForAntagonistId:function(a,b,c){var d="/acts/antagonistId/"+a;d+=b?"?since="+b:"",this.query("GET",d,c)},createAct:function(a,b,c){var d="/acts";this.query("POST",d,b,c,a)},readAct:function(){},updateAct:function(){},deleteAct:function(a,b,c){var d="/acts/"+a.id;this.query("DELETE",d,b,c)},actLikeEntity:function(a,b,c,d){var e="/acts/"+a+"/like/"+b;this.query("GET",e,c,d)},actDislikeEntity:function(a,b,c,d){var e="/acts/"+a+"/dislike/"+b;this.query("GET",e,c,d)},actClickEntity:function(a,b,c,d){var e="/acts/"+a+"/click/"+b;this.query("GET",e,c,d)},findEntities:function(){},findEntitiesById:function(){},findEvaluationForEntity:function(a,b,c,d){var e="/entities/"+a+"/evaluation/"+b;this.query("GET",e,c,d)},getDevice:function(a,b,c,d,e,f,g){var h="/logo/"+a+"/"+b;if(c||d||e)h+="?";c&&(h+="since="+c),d&&(h+="&protagonistId="+d),e&&(h+="&antagonistId="+e),this.query("GET",h,f,g)},list:function(a,b){var c="/master/list";this.query("GET",c,a,b)},listAtc:function(a,b,c){a=encodeURIComponent(a);var d="/master/"+a;this.query("GET",d,b,c)},listForm:function(a,b,c){a=encodeURIComponent(a);var d="/master/"+a+"/form";this.query("GET",d,b,c)},listName:function(a,b,c,d){a=encodeURIComponent(a),b=encodeURIComponent(b);var e="/master/"+a+"/"+b+"/name";this.query("GET",e,c,d)},listMenge:function(a,b,c,d,e){a=encodeURIComponent(a),b=encodeURIComponent(b),c=encodeURIComponent(c);var f="/master/"+a+"/"+b+"/"+c+"/menge";this.query("GET",f,d,e)},query:function(a,b,c,d,e){this.ajax(a,this.server+b,c,d,e)},ajax:function(a,b,c,d,e){a=="GET"&&typeof d=="object"&&(b+="?"+this.toQuery(d));var f=new XMLHttpRequest||ActiveXObject("MSXML2.XMLHTTP.3.0");f.open(a,b,!0),d&&f.setRequestHeader("Content-Type","application/json"),e&&f.setRequestHeader("Authorization",e),f.onreadystatechange=function(){f.readyState==4&&(f.status==200&&f.responseText?c({status:f.status,message:JSON.parse(f.responseText)}):c({status:f.status,message:f.statusText}))},f.send(JSON.stringify(d))},toQuery:function(a){var b=[];for(var c in a)b.push(encodeURIComponent(c)+"="+encodeURIComponent(a[c]));return b.join("&")},form:function(a,b,c){var d=DOM().fragment("form");d.attrib("method",a),d.attrib("action",b);for(var e in c)c.hasOwnProperty(e)&&d.add("input").attrib("type","hidden").attrib("name",e).attrib("value",c[e]);d.element.submit()}};
